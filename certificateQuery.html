<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="css/mui.min.css" rel="stylesheet" />
		<style type="text/css">
			body {
				background-color: #FFFFFF;
				font-family: "微软雅黑";
			}
			
			.mui-content {
				background-color: #FFFFFF
			}
			
			.mui-content>img {
				padding: 14px 0;
			}
			
			.mui-content>form {
				padding: 0 25px;
			}
			
			.mui-content>form>h6 {
				font-size: 10.5px;
				color: #f2b928;
				margin-bottom: 12.5px;
				padding-left: 14px;
			}
			
			.mui-content>form input {
				font-size: 14px;
				display: block;
				box-sizing: border-box;
				border-radius: 0;
				height: 32.5px;
				font-family: "微软雅黑";
				margin-bottom: 9px;
			}
			
			.mui-content>form>img {}
			
			#code {
				float: left;
				width: 50%;
				margin-right: 12px;
			}
			
			#Verification {}
			
			.mui-content>form>div {
				width: 100%;
				height: 32.5px;
			}
			
			.mui-content>form>div:nth-of-type(1) {
				margin-bottom: 9px;
			}
			
			#check {
				margin: 0 auto;
				padding: 0;
				height: 32.5px;
				border-radius: 0;
				display: block;
				font-size: 14px;
				width: 20%;
				color: #FFFFFF;
				background-color: #f2b928;
				border: none;
			}
			
			li {
				list-style: none;
			}
			
			ul {
				padding: 20px 25px;
				border-top: 4.5px solid #f3f3f3;
			}
			
			ul li {
				padding-left: 14px;
				height: 32px;
				line-height: 32px;
				border: 1px solid #ededed;
				font-size: 14px;
				color: #828282;
				margin-bottom: 7.5px;
			}
		</style>
	</head>

	<body>
		<div class="mui-content" id="queryList">
			
			<img src="images/home/home_new2.png" width="100%" />
			<form>
				<h6>*请填写如下信息</h6>
				<input type="text" id="yours" value="" placeholder="请输入姓名" />
				<input type="text" id="number" value="" placeholder="请输入身份证号" />
				<div>
					<input type="text" id="code" value="" placeholder="请输入验证码" />
					<img src="images/60x60.gif" height="32.5" id="Verification" />
				</div>

				<div><button type="submit" id="check">查询</button></div>
			</form>
			<!--<ul>
	    	<li>姓名 : 黄娇娇</li>
	    	<li>身份证号 : 30683199208117325</li>
	    	<li>获得证书 : 专项技术证书</li>
	    	<li>获证时间 : 2016-04-25</li>
	    	<li>获证方式 : 凭自己的努力获得</li>
	    </ul>
	     <ul>
	    	<li>姓名 : 黄娇娇</li>
	    	<li>身份证号 : 30683199208117325</li>
	    	<li>获得证书 : 专项技术证书</li>
	    	<li>获证时间 : 2016-04-25</li>
	    	<li>获证方式 : 凭自己的努力获得</li>
	    </ul>-->
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/extra.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" charset="UTF-8">
		mui.plusReady(function  () {
			mui.init({  
					//下拉刷新
					pullRefresh: {
						container: '#queryList', //待刷新区域标识，querySelector能定位的css选择器均可，比如：id、.class等
						up: {
							height: 50, //可选.默认50.触发上拉加载拖动距离
							auto: false, //可选,默认false.自动上拉加载一次
							contentrefresh: "正在加载...", //可选，正在加载状态时，上拉加载控件上显示的标题内容
							contentnomore: '没有更多数据了', //可选，请求完毕若没有更多数据时显示的提醒内容；
							callback: pullupRefresh //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
						}
					}
				});
			/*var certificateQuery = [
				["姓名 : 黄娇娇", "身份证号 : 30683199208117325", "获得证书 : 专项技术证书", "获证时间 : 2016-04-25", "获证方式 : 凭自己的努力获得"],
				["姓名 : 黄娇娇", "身份证号 : 30683199208117325", "获得证书 : 专项技术证书", "获证时间 : 2016-04-25", "获证方式 : 凭自己的努力获得"]
			]*/
			//********创建证书内容
			var createFragment = function(data) {
				var fragment = document.createDocumentFragment();
				for (var i = 0; i < data.length; i++) {
					var ul = document.createElement("ul");
					ul.innerHTML='<li>姓名 :'+data[i].Name+'</li><li>身份证号 : '+data[i].IdNumber+'</li><li>获得证书 : '+data[i].CertName+'</li><li>获证时间 : '+data[i].Time+'</li><li>获证方式 : '+data[i].Obtaintype+'</li>'
					fragment.appendChild(ul);
				}
				return fragment;
			};
			
			var names = document.getElementById("yours");
			//姓名
			var number = document.getElementById("number");
			//身份证号码
			var code = document.getElementById("code");
			//验证码
			var check = document.getElementById("check");
			//查询
			var data = {
				
			};
			//定义分页数量
			var count=1;
			names.addEventListener('input', function() {
				this.onblur = function() {
					this.onblur = null;
					var re=new RegExp('^[\\u4e00-\\u9fa5]{0,}$');
					//只能是汉字
					if (re.test(this.value)) {
						data.name = this.value;
					} else{
						mui.alert("请填写正确的姓名",'格式错误','是');
					}
					
				}
			})
			number.addEventListener('input', function() {
				this.onblur = function() {
					this.onblur = null;
					var re=/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/;
					if (re.test(this.value)) {
						data.number = this.value;
					} else{
						mui.alert("请填写正确的身份证号码",'格式错误','是');
					}
					
				}
			})
			code.addEventListener('input', function() {
				this.onblur = function() {
					this.onblur = null;
					data.code = this.value;
				}
			})
			
			function pullupRefresh(){
				if (data.name) {
					if (data.number) {
						if (data.code) {
							var header = JSON.parse(plus.storage.getItem('header'));
							var datas=JSON.stringify({
										Header: header,
										Body: {
											PageIndex: count,
											PageSize: 10
										}
								});
							sendAjax('api/Course/GetCertificateList',datas,function  () {
								if(data.Body.TotalCount > 0) {
									newList.appendChild(createFragment(data.Body.Items));
									count++; 
									mui('#queryList').pullRefresh().endPullupToRefresh(false);
								} else {
									mui('#queryList').pullRefresh().endPullupToRefresh(true);
								} 
							},function  () {
								mui('#queryList').pullRefresh().endPullupToRefresh(true);
							})
						} else {
							mui.alert('请填写验证码', '信息补全', '是');
						}
					} else {
						mui.alert('请填写身份证号码', '信息补全', '是');
					}
				} else {
					mui.alert('请填写姓名', '信息补全', '是');
				}
			}
			
			check.addEventListener('tap', function() {
				pullupRefresh();
			})
		})
			
		</script>
	</body>

</html>