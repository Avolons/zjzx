<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>cloud</title>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/iconfont.css" />
		<style type="text/css">
			body {
				font-family: "微软雅黑";
			}
			
			li {
				list-style: none;
			}
			
			nav {
				position: absolute;
				top: 44px;
				left: 0;
				width: 100%;
			}
			
			nav>ul {
				width: 100%;
				padding: 0;
				margin: 0;
				height: 30px;
				background-color: white;
				border-bottom: 1px solid #e7e7e7;
			}
			
			nav>ul>li {
				font-size: 13px;
				width: 50%;
				height: 30px;
				line-height: 30px;
				float: left;
				display: -webkit-box;
				-webkit-box-pack: center;
			}
			
			nav>ul>li:after {
				height: 15px;
				width: 1px;
				display: block;
				content: "";
				position: absolute;
				right: -1px;
				top: 10px;
				background-color: #DADADA;
			}
			
			.mui-bar-nav {
				background-color: #e93f32;
			}
			
			.mui-bar-nav h1 {
				font-size: 20px;
				color: #FFFFFF;
			}
			
			.mui-content>.mui-table-view:first-child {
				margin-top: 40px;
			}
			
			.mui-table-view-cell {
				padding: 0;
				/*border-bottom: 3px solid rgba(0,0,0,.2);*/
			}
			
			.mui-table-view-cell>a:not(.mui-btn) {
				margin: 0;
			}
			
			.mui-table-view .mui-media-object {
				display: block;
			}
			
			.mui-table-view-cell:after {
				background-color: transparent;
				height: 0;
			}
			
			.mui-table-view-chevron .mui-table-view-cell {
				padding: 0;
				height: 36px;
			}
			
			.mui-table-view-chevron .mui-table-view-cell>a:not(.mui-btn) {
				margin: 0;
			}
			
			#moreCourse {
				background-color: transparent
			}
			
			#moreCourse li p {
				font-size: 10px;
				color: #333;
			}
			
			#moreCourse li .last {
				overflow-wrap: break-word
			}
			
			#moreCourse li {
				padding: 0 8px;
				height: 80px;
				box-sizing: border-box;
				background-color: #FFFFFF;
				margin-bottom: 5px;
			}
			
			#moreCourse li:after {
				content: "";
				display: block;
				clear: both;
			}
			
			#moreCourse li a {
				margin: 0;
				height: 100%;
			}
			
			#moreCourse li a div {
				display: -webkit-box;
				-webkit-box-orient: vertical;
				-webkit-box-pack: justify;
				height: 100%;
				margin-left: 10px;
				float: left;
				white-space: normal;
			}
			
			#moreCourse li a img {
				width: 134px;
				overflow: hidden;
				margin-right: 10px;
				display: block;
				height: 100%;
			}
			
			#moreCourse li a div p {
				color: #999999;
				margin-bottom: 10px;
			}
			
			#moreCourse li a div p span {
				color: #999999;
				font-size: 10px;
				display: block;
				height: 21px;
				line-height: 21px;
				width: 10px;
				float: left;
				margin-right: 2px;
			}
			
			#moreCourse li a div h3 {
				margin: 0;
				line-height: 2;
				height: calc(100% / 2);
				color: #5a5a5a;
				font-size: 16px;
				margin-top: 10px;
				font-weight: 400;
			}
			
			.mui-table-view-cell:after {
				height: 0;
			}
			
			.course-list a {
				font-size: 12px;
				height: 35px;
				line-height: 35px;
				width: 100%;
				text-indent: 10px;
			}
			
			nav>ul>li>a {
				color: #333333;
				font-size: 13px;
			}
			
			#nav .level_one>a>span {
				color: #d8d8d8;
				-webkit-transform: rotate(180deg);
				font-size: 12px;
				margin-left: 3px;
			}
			
			#nav .touch>a>span {
				-webkit-transform: rotate(0);
			}
			
			nav>ul>li ul {
				display: none;
				font-size: 13px;
				padding: 0;
				width: 100%;
				position: absolute;
				top: 30px;
				left: 0;
				background-color: #f7f7f7
			}
			
			nav>ul .touch>ul .select:before {
				content: '√';
				display: block;
				float: left;
				color: #E93F32;
				height: 40px;
				line-height: 40px;
				margin-left: -10%;
			}
			
			nav>ul>li>ul>li {
				height: 40px;
				line-height: 40px;
				box-sizing: border-box;
				padding-left: 15%;
				font-size: 15px;
				width: 100%;
				box-sizing: border-box;
				border-bottom: 1px solid #e7e7e7;
			}
			
			nav>ul>li>ul .select {
				background-color:white;
			}
			
			nav>ul .level_one>a {
				color: #333333;
			} 
			
			nav>ul .touch>ul .select {
				color: #e93f32;
			}
			
			nav>ul .level_one>ul>li {
				color: #333333;
			}
			
			nav>ul .touch>a {
				color: #e93f32;
			}
			
			nav>ul .touch>ul {
				display: block;
			}
			
			.mui-scroll {
				top: 74px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<h1 class="mui-title">云课堂</h1>
			<nav>
				<ul id="nav">
					<li class="level_one">
						<a href="javascript:void(0);">最近学习<span class="mui-icon iconfont icon-down-copy-copy"></span></a>
						<ul>
							<li class="">最近学习</li>
							<li>最新课程</li>
						</ul>
					</li>
					<li class="level_one">
						<a href="javascript:void(0);">全部<span class="mui-icon iconfont icon-down-copy-copy"></span></a>
						<ul>
							<li>全部</li>
							<li>未学习</li>
							<li>学习中</li>
							<li>已暂定</li>
							<li>已完成</li>
							<li>已过期</li>
						</ul>
					</li>
				</ul>
			</nav>
		</header>
		<div class="mui-content" id="pullupRefresh">
			<div class="mui-scroll" style="position:absolute;  top: 74px;width: 100%;">
				<ul class="mui-table-view" id="moreCourse">
					<!--<li class="mui-table-view-cell mui-media">
						<a href="javascript:void(0);" class="">
							<img class=" mui-pull-left" src="images/center/center (1).png">
							<div class="title">
								<h3>情商与影响力</h3>
								<p><span class="mui-icon iconfont icon-shizhong"></span>上次学习时间：11月16日</p>
							</div>
						</a>
					</li>-->
				</ul>
			</div>
		</div>
		<script src="js/jquery-2.1.0.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/extra.js" type="text/javascript" charset="utf-8"></script> 
		<script type="text/javascript">
		/*
		 云课堂后期一定会添加下拉加载和上拉刷新功能，目前使用下拉刷新功能会导致classlist未定义错误，暂时没有解决，可能要参考示例使用双webvie写法，
		 云课堂属于私有功能，因此在点击时一定会检查用户的登录状态
		 * */
			mui.plusReady(function() {
//				mui.init({
//					//下拉刷新
//					pullRefresh: {
//						container: '#pulluprefresh', //待刷新区域标识，querySelector能定位的css选择器均可，比如：id、.class等
//						up: {
//							height: 50, //可选.默认50.触发上拉加载拖动距离
//							auto:true,
//							contentrefresh: "正在加载...", //可选，正在加载状态时，上拉加载控件上显示的标题内容
//							contentnomore: '没有新内容', //可选，请求完毕若没有更多数据时显示的提醒内容；
//							callback: pulluprefresh //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
//						}
//					} 
//				});
				//*****状态函数
				var Sorttype = 0;
				var LearnState = -1;
				
				
				var dataobj={
					'最近学习':0,
					'最新课程':1,
					'全部':-1,
					'未学习':0,
					'学习中':1,
					'已暂定':2,
					'已完成':3,
					'已过期':4
				}
				//***分页
				var count = 1; 
				var course = document.getElementById("moreCourse");
				//**********************课程渲染函数
				var createCourseList = function(courselist) {
					var fragment = document.createDocumentFragment();
					var li;
					for(var i = 0; i < courselist.length; i++) {
						li = document.createElement('li');
						li.className = 'mui-table-view-cell mui-media';
						li.id = courselist[i].Id;
						//							li.setAttribute('data-process')=courselist[i].LearnProcess;
						li.innerHTML = "<a href='javascript:void(0);' class=''><img  class='mui-pull-left' src=" + courselist[i].Src + "><div class='title'><h3>" + courselist[i].Title + "</h3><p><span class='mui-icon iconfont icon-shizhong'></span>上次学习时间：" + courselist[i].Time + "</p></div></a>"
						fragment.appendChild(li); 
					}
					return fragment;
				};

				//**********刷新函数
				function pulluprefresh() {
//					setTimeout(function() {
						var header = JSON.parse(plus.storage.getItem('header'));
						var datas = JSON.stringify({
							Header: header,
							Body: {
								PageIndex: count,
								PageSize: 99,
								Sorttype: Sorttype,
								LearnState: LearnState
							}
						});
//						console.log(JSON.stringify(data));
						sendAjax('api/Course/GetMyCourseList', datas, function(data) {
							console.log(JSON.stringify(data)); 
							if(data.Code == 200) {
								if(data.Body.TotalCount > 0) {
									course.appendChild(createCourseList(data.Body.Items));
									count++;
								} else {
								}
							} else {
								mui.alert(data.Message);
							}
						}, function() {
						})
//					}, 500);
				};
				//************监听自定义事件
				window.addEventListener('clicked', function(event) {
					if (!mui('#moreCourse').innerHTML) {
						setTimeout(function() {
						urlopenwindow(function() {
							pulluprefresh();
						});
					}, 500);
					} else{
						return false;
					}
					//获得事件参数
					
					//根据id向服务器请求新闻详情
				});

				//***********login返回事件
				window.addEventListener('token', function(event) {
					//获得事件参数
					console.log(1)
					urlopenwindow(function() {
						pulluprefresh();
					});
					//根据id向服务器请求新闻详情
				});

				$(".level_one").on("tap", function() {
						$(this).toggleClass("touch").siblings().removeClass("touch");
				}) 
					//一级列表的点击切换
				$(".level_one>ul>li").on("tap", function() {
						$(this).parent().parent().children("a").html($(this).html() + '<span class="mui-icon iconfont icon-down-copy-copy"></span>');
						$(this).toggleClass("select").siblings().removeClass("select");
						//清空列表
						course.innerHTML = '';
						//重置筛选条件
						Sorttype = dataobj[$(".level_one>a").eq(0).text()];
						LearnState = dataobj[$(".level_one>a").eq(1).text()];
						//重置分页
						count = 1;
						pulluprefresh();
					})
					//二级列表的点击切换，并且将当前值传给一级列表

				var detailPage = null;
				mui('#moreCourse').on('tap', 'li', function(e) {
					var imgsrc=this.querySelectorAll('img')[0].getAttribute('src');
					var courseid = this.getAttribute('id');
					//向后台传输自带的id值,将id值传递进去
					//打开详情页面          
					var detailPage = null;
					//				  向后台传输自带的id值
					//获得详情页面
					if(!detailPage) {
						detailPage = plus.webview.getWebviewById('courseInformation.html');
					}
					//触发详情页面的newsId事件
					mui.fire(detailPage, 'newsId', {
						id:courseid,
						src:imgsrc 
					});
					//打开详情页面          
					mui.openWindow({
						id: 'courseInformation.html'
					});
				});
			})
		</script>
	</body>

</html>